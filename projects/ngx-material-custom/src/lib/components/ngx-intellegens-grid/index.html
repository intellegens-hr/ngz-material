<table mat-table
  class="mat-elevation-z8"
  [dataSource] ="data | ngxIntellegensGridFilterBy:filters
                      | ngxIntellegensGridOrderBy:orderingField:orderingAscDirection
                      | ngxIntellegensGridPaginate:pageLength:pageIndex" 
  matSort matSortDisableClear="true" (matSortChange)="onMatTableSort($event)">

  <!-- Header definition (and layout) -->
  <ng-container *matHeaderRowDef="columnKeys">
    <!-- Default headers -->
    <tr mat-header-row></tr>
    <!-- Filtering row -->
    <tr *ngIf="config.filtering.hasFiltering && config.filtering.hasFilteringColumns">
      <th *ngFor="let key of columnKeys">
          <input type="text" [disabled]="config.columns[key].virtual || !config.columns[key].hasFiltering"
                 class="filter-input"
                 [value]="filters[key] || ''"
                 (keyup)="onFilterUpdated(key, $event)"
                 (change)="onFilterUpdated(key, $event)">
      </th>
    </tr>
  </ng-container>

  <!-- Table columns layout -->
  <ng-container *ngFor="let key of columnKeys" [matColumnDef]="key">

    <!-- Column header -->
    <th mat-header-cell *matHeaderCellDef
      mat-sort-header [disabled]="!config.columns[key].hasOrdering || config.columns[key].virtual">
      <!-- If template available -->
      <ng-container *ngIf="config.columns[key].headerCellTemplate">
        <ng-container
          *ngTemplateOutlet="
            config.columns[key].headerCellTemplate,
            context: headerAndFooterTemplateContext(key)
          "
        ></ng-container>
      </ng-container>
      <!-- If no template, default to column label -->
      <ng-container *ngIf="!config.columns[key].headerCellTemplate">
        {{ config.columns[key].header ? config.columns[key].header : key }}
      </ng-container>
    </th>

    <!-- Column body cell -->
    <td mat-cell *matCellDef="let row">
      <!-- If template available -->
      <ng-container *ngIf="config.columns[key].cellTemplate">
        <ng-container
          *ngTemplateOutlet="
            config.columns[key].cellTemplate,
            context: bodyCellTemplateContext(row, key)
          "
        ></ng-container>
      </ng-container>
      <!-- If no template, default to raw row value -->
      <ng-container *ngIf="!config.columns[key].cellTemplate && !config.columns[key].virtual">
        {{ row[key] }}
      </ng-container>      
    </td>

    <!-- Column footer -->
    <td mat-footer-cell *matFooterCellDef>
      <!-- If template available -->
      <ng-container *ngIf="config.columns[key].footerCellTemplate">
        <ng-container
          *ngTemplateOutlet="
            config.columns[key].footerCellTemplate,
            context: headerAndFooterTemplateContext(key)
          "
        ></ng-container>
      </ng-container>
      <!-- If no template, default to column label -->
      <ng-container *ngIf="!config.columns[key].footerCellTemplate">
        {{ config.columns[key].footer ? config.columns[key].footer : key  }}
      </ng-container>
    </td>

  </ng-container>

  <!-- Body row(s) definition (and layout) -->
  <ng-container *matRowDef="let row; columns: columnKeys;">
    <!-- Default body row cells -->
    <tr mat-row></tr>
  </ng-container>

  <!-- Footer definition (and layout) -->
  <ng-container *matFooterRowDef="columnKeys">
    <!-- Default footers -->
    <tr mat-footer-row></tr>
  </ng-container>

</table>

<!-- Pagination -->
<mat-paginator *ngIf="config.pagination.hasPagination !== false"
  class="mat-elevation-z8"
  [length]="totalLength" [pageSize]="config.pagination.defaultPageLength"  [pageSizeOptions]="config.pagination.pageLengthOptions"
  (page)="onMatTablePage($event)"></mat-paginator>

<!-- Error overlay -->
<div class="overlay-container" *ngIf="error || internalError">
  <div class="overlay-content">Error</div>
</div>

<!-- Loading overlay -->
<div class="overlay-container" *ngIf="((!error && !internalError) && (loading || internalLoading))">
  <div class="overlay-content">Loading</div>
</div>
